# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

## –ü–µ—Ä–µ—Ö–æ–¥ —Å —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–µ—Ä–µ–π—Ç–∏ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `whisper_ollama_ptt_windows.py` –Ω–∞ –Ω–æ–≤—É—é –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## üÜï –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
‚îú‚îÄ‚îÄ whisper_ollama_ptt_windows.py (–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª)

–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
‚îú‚îÄ‚îÄ ptt_app.py (–æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ config.py (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ logging_config.py (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îú‚îÄ‚îÄ audio_manager.py (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ)
‚îú‚îÄ‚îÄ transcription_service.py (Whisper)
‚îú‚îÄ‚îÄ llm_service.py (Ollama)
‚îú‚îÄ‚îÄ text_injection_service.py (–≤—Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞)
‚îú‚îÄ‚îÄ tray_interface.py (—Ç—Ä–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
‚îî‚îÄ‚îÄ test_modules.py (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ YAML/JSON —Ñ–∞–π–ª–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å —É—Ä–æ–≤–Ω—è–º–∏ –∏ —Ä–æ—Ç–∞—Ü–∏–µ–π
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ retry –ª–æ–≥–∏–∫–∞
5. **–¢—Ä–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –º–µ–Ω—é —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∏ —Ç–µ—Å—Ç–∞–º–∏

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
pip uninstall faster-whisper sounddevice keyboard pyperclip requests pystray pillow numpy

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   ```bash
   cp config_example.yaml config.yaml
   ```

2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.yaml` –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã:**
   ```yaml
   ptt_key: "f9"  # –í–∞—à–∞ –∫–ª–∞–≤–∏—à–∞ PTT
   whisper:
     model: "small"  # –í–∞—à–∞ –º–æ–¥–µ–ª—å Whisper
   ollama:
     model: "qwen2.5:7b-instruct"  # –í–∞—à–∞ –º–æ–¥–µ–ª—å Ollama
   ```

3. **–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   set PTT_KEY=f9
   set WHISPER_MODEL=small
   set OLLAMA_MODEL=qwen2.5:7b-instruct
   ```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –í–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞
# python whisper_ollama_ptt_windows.py

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π
python ptt_app.py
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª–µ–π
python test_modules.py
```

## üîÑ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

| –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|---------------|--------------|------------|
| `CFG.PTT_KEY` | `config.ptt_key` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å |
| `log()` | `logger.info()` | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `_audio_buf` | `AudioManager` | –£–ø—Ä–∞–≤–ª—è–µ–º—ã–π –±—É—Ñ–µ—Ä —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ |
| `_whisper` | `WhisperService` | –°–µ—Ä–≤–∏—Å —Å retry –ª–æ–≥–∏–∫–æ–π |
| `_postprocess_with_ollama()` | `LLMService` | –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è LLM |
| `_inject_text()` | `TextInjectionService` | –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ —Å fallback |
| `_setup_tray()` | `TrayIcon` | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç—Ä–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ò–º–ø–æ—Ä—Ç—ã
```python
# –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
from faster_whisper import WhisperModel
import sounddevice as sd

# –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
from transcription_service import WhisperService
from audio_manager import AudioManager
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
# –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
CFG = Config()

# –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
from config import CONFIG
# –∏–ª–∏
config = AppConfig.from_file("config.yaml")
```

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
log("message")

# –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
logger = get_logger("module_name")
logger.info("message")
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
# –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
except Exception as e:
    log(f"Error: {e}")

# –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
except SpecificError as e:
    logger.error(f"Specific error: {e}")
except Exception as e:
    logger.exception("Unexpected error")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π
```bash
python test_modules.py
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```python
from config import CONFIG
print(CONFIG.validate())  # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å True
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
from logging_config import setup_logging, get_logger
logger = setup_logging(CONFIG.logging)
logger.info("Test message")
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```python
from audio_manager import AudioManager
from transcription_service import WhisperService

audio_manager = AudioManager(CONFIG.audio)
whisper_service = WhisperService(CONFIG.whisper)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
devices = audio_manager.get_available_devices()
print(f"Audio devices: {len(devices)}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Whisper
model_info = whisper_service.get_model_info()
print(f"Whisper status: {model_info['status']}")
```

## üö® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–∞–∫–µ—Ç—ã
pip install pyyaml pywin32
```

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ PowerShell –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É–¥–∏–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥—Ä–∞–π–≤–µ—Ä—ã WASAPI/WDM-KS —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞—É–¥–∏–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å Ollama
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Ollama –∑–∞–ø—É—â–µ–Ω: `ollama serve`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏: `ollama list`

## üîß –û—Ç–ª–∞–¥–∫–∞

### 1. –õ–æ–≥–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `ptt.log`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `DEBUG`

### 2. –¢–µ—Å—Ç—ã
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
python test_modules.py 2>&1 | tee test_output.log
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```python
from config import CONFIG
print(CONFIG.to_dict())  # –í—ã–≤–µ–¥–µ—Ç –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫:

1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º—É —Ç—Ä–µ–π-–º–µ–Ω—é** —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** –ø—Ä—è–º–æ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
3. **–î–µ—Ç–∞–ª—å–Ω–æ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é** —Å —É—Ä–æ–≤–Ω—è–º–∏
4. **–ì–∏–±–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
6. **Retry –ª–æ–≥–∏–∫–µ** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

## üÜò –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `ptt.log`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python test_modules.py`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
5. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
2. –ò–∑—É—á–∏—Ç–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–π-–º–µ–Ω—é
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
5. –í–Ω–µ—Å–∏—Ç–µ —Å–≤–æ–π –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
